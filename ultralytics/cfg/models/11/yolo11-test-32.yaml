# Ultralytics YOLO ðŸš€, AGPL-3.0
# YOLO12 SMART-P3 NANO: Manual Scaled
# Logic: P2 Injection (High Detail) | Params: ~2.4M | Speed: Fast

nc: 80
scales:
  n: [0.50, 0.25, 1024]
  s: [0.50, 0.50, 1024]
  m: [0.50, 1.00, 512]
  l: [1.00, 1.00, 512]
  x: [1.00, 1.50, 512]

backbone:
  # [from, repeats, module, args]
  # YOLO tá»± scale (x0.25): 256->64, 512->128, 1024->256
  - [-1, 1, Conv, [64, 3, 2]]             # 0
  - [-1, 1, Conv, [128, 3, 2]]            # 1
  - [-1, 2, C3k2, [256, False, 0.25]]     # 2 (P2 - 64ch)
  - [-1, 1, Conv, [256, 3, 2]]            # 3
  - [-1, 2, C3k2, [512, False, 0.25]]     # 4 (P3 - 128ch)
  - [-1, 1, Conv, [512, 3, 2]]            # 5
  - [-1, 2, C3k2, [512, True]]            # 6 (P4 - 128ch)
  - [-1, 1, Conv, [1024, 3, 2]]           # 7
  - [-1, 2, C3k2, [1024, True]]           # 8 (P5 - 256ch)
  - [-1, 1, SPPF, [1024, 5]]              # 9

  # MANUAL SCALE: TripletAttention [256] (Khá»›p vá»›i P5 Nano)
  - [-1, 1, TripletAttention, [256]]      # 10

head:
  # === Top-down (P5 -> P4 -> P3) ===
  - [-1, 1, nn.Upsample, [None, 2, "nearest"]]   # 11

  # MANUAL SCALE: P4 target 128 channels (Gá»‘c 512 / 4)
  - [[-1, 6], 1, BiFPN, [128]]                   # 12
  # C3k2 [512] -> Auto scale thÃ nh 128
  - [-1, 2, C3k2, [512, False]]                  # 13

  - [-1, 1, nn.Upsample, [None, 2, "nearest"]]   # 14

  # MANUAL SCALE: P3 target 64 channels (Gá»‘c 256 / 4)
  - [[-1, 4], 1, BiFPN, [64]]                    # 15
  # C3k2 [256] -> Auto scale thÃ nh 64
  - [-1, 2, C3k2, [256, False]]                  # 16 (P3 Top-down)

  # === ðŸ”¥ P2 INJECTION (MANUAL SCALED) ===
  # Láº¥y P2 (Layer 2) -> Conv giáº£m size xuá»‘ng P3
  # C3k2 [256] -> Auto scale thÃ nh 64 channels
  - [2, 1, Conv, [256, 3, 2]]                    # 17 (P2 downsample -> 64ch)

  # Há»£p nháº¥t P3: [P3 Top-down (64), P3 Backbone (128), P2 Injection (64)]
  # MANUAL SCALE: Output target 64 channels
  - [[16, 4, 17], 1, BiFPN, [64]]                # 18
  # C3k2 [256] -> Auto scale thÃ nh 64
  - [-1, 2, C3k2, [256, False]]                  # 19
  # CoordAtt 64 channels (Nháº¹ há»u, giá»¯ láº¡i Ä‘Æ°á»£c)
  - [-1, 1, CoordAtt, []]                        # 20 -> Detect P3

  # === Bottom-up (P3 -> P4 -> P5) ===
  # P3 lÃªn P4
  - [-1, 1, Conv, [256, 3, 2]]                   # 21 (Input 64 -> Output 64)

  # Há»£p nháº¥t P4. MANUAL SCALE: Output target 128
  - [[-1, 6, 13], 1, BiFPN, [128]]               # 22
  # C3k2 [512] -> Auto scale thÃ nh 128
  - [-1, 2, C3k2, [512, False]]                  # 23
  - [-1, 1, CoordAtt, []]                        # 24 -> Detect P4

  # P4 lÃªn P5
  - [-1, 1, Conv, [512, 3, 2]]                   # 25 (Input 128 -> Output 128)

  # Há»£p nháº¥t P5. MANUAL SCALE: Output target 128 (Slim P5 cho nháº¹)
  # LÆ°u Ã½: á»ž báº£n cÅ© báº¡n Ä‘á»ƒ 512 nÃªn nÃ³ náº·ng. á»ž Ä‘Ã¢y tÃ´i Ä‘á»ƒ 128 (chuáº©n Nano).
  - [[-1, 10], 1, BiFPN, [128]]                  # 26
  # C3k2 [512] -> Auto scale thÃ nh 128
  - [-1, 2, C3k2, [512, True]]                   # 27 -> Detect P5

  # Detect (P3, P4, P5)
  # Output channels thá»±c: [64, 128, 128]
  - [[20, 24, 27], 1, Detect, [nc]]